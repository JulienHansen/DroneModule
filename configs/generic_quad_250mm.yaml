# ============================================================
# Generic 250 mm 5-inch quadrotor — example configuration
# ============================================================
# Representative of a lightweight 5" freestyle/research quad
# (~250 g all-up weight, 2306 motors, 5" props).
#
# NOTE: gains below are reasonable starting points only.
# Real tuning requires flight testing or system identification.
#
# Compared to the Crazyflie:
#   - ~10× heavier  →  higher absolute torques needed
#   - ~100× higher inertia  →  lower kp on rate (same α response)
#   - Higher thrust margin  →  more aggressive position control possible
# ============================================================

drone:
  name: "Generic 250mm 5-inch quad"
  mass: 0.250            # kg  (~250 g all-up weight)
  inertia:               # Principal moments [kg·m²]
    ixx: 2.5e-3          # Roll  axis
    iyy: 2.5e-3          # Pitch axis
    izz: 4.5e-3          # Yaw   axis (larger due to motor arm layout)
  max_thrust: 12.0       # N  (4 × ~3 N per motor at full throttle)

controllers:

  # ----------------------------------------------------------
  # Attitude controller
  # ----------------------------------------------------------
  attitude:
    freq_rate_hz:  500   # Typical inner loop on a 32-bit FC
    freq_angle_hz: 100   # Outer loop (position hold / auto modes)

    # Inner loop: body-rate error [rad/s] → angular acceleration [rad/s²]
    rate:
      roll:  { kp: 25.0, ki: 5.0,  kd: 0.5, tau: 0.005, limit: 50.265 }
      pitch: { kp: 25.0, ki: 5.0,  kd: 0.5, tau: 0.005, limit: 50.265 }
      yaw:   { kp: 15.0, ki: 2.0,  kd: 0.0, tau: 0.005, limit: 25.133 }

    # Outer loop: angle error [rad] → body-rate setpoint [rad/s]
    angle:
      roll:  { kp: 6.0, ki: 0.0, kd: 0.0, tau: 0.01, limit: 15.708 }
      pitch: { kp: 6.0, ki: 0.0, kd: 0.0, tau: 0.01, limit: 15.708 }
      yaw:   { kp: 4.0, ki: 0.0, kd: 0.0, tau: 0.01, limit: 10.0   }

  # ----------------------------------------------------------
  # Position controller
  # ----------------------------------------------------------
  position:
    freq_vel_hz: 100
    freq_pos_hz: 50

    max_thrust_scale: 0.85
    max_horizontal_angle_deg: 35.0   # More aggressive lean than Crazyflie

    velocity:
      vx: { kp: 2.0, ki: 0.1, kd: 0.0, tau: 0.10, limit: 9999.0 }
      vy: { kp: 2.0, ki: 0.1, kd: 0.0, tau: 0.10, limit: 9999.0 }
      vz: { kp: 2.0, ki: 0.2, kd: 0.0, tau: 0.10, limit: 9999.0 }

    position:
      x: { kp: 4.0, ki: 0.0, kd: 0.8, tau: 0.10, limit: 8.0 }
      y: { kp: 4.0, ki: 0.0, kd: 0.8, tau: 0.10, limit: 8.0 }
      z: { kp: 4.0, ki: 0.2, kd: 2.0, tau: 0.10, limit: 5.0 }

  # ----------------------------------------------------------
  # CascadePIDController  (firmware-style multi-rate cascade)
  # ----------------------------------------------------------
  # Gains scaled for a 250 g / 250 mm 5-inch quad.
  # Compared to the Crazyflie: ~10× heavier, ~100× higher inertia,
  # higher thrust margin → lower rate kp (same angular acceleration),
  # more aggressive position control possible.
  #
  # Unit conventions: same as crazyflie.yaml cascade_pid section.
  # ----------------------------------------------------------
  cascade_pid:
    sim_rate_hz:            500.0
    pid_posvel_loop_rate_hz: 100.0
    pid_loop_rate_hz:        500.0

    # ── Position loop  (error [m] → velocity setpoint [m/s]) ──────────────
    pos_kp:  [3.0,  3.0,  3.0]
    pos_ki:  [0.0,  0.0,  0.5]
    pos_kd:  [0.0,  0.0,  0.0]
    pos_kff: [0.0,  0.0,  0.0]

    # ── Velocity loop  (error [m/s] → roll/pitch cmd [deg] or thrust Δ) ──
    vel_kp:  [20.0, 20.0, 20.0]
    vel_ki:  [ 2.0,  2.0, 10.0]
    vel_kd:  [ 0.0,  0.0,  0.0]
    vel_kff: [ 0.0,  0.0,  0.0]

    # ── Attitude loop  (error [rad] → body-rate setpoint [rad/s]) ─────────
    att_kp:  [8.0, 8.0, 6.0]
    att_ki:  [2.0, 2.0, 1.0]
    att_kd:  [0.0, 0.0, 0.2]
    att_kff: [0.0, 0.0, 0.0]

    # ── Rate loop  (error [rad/s] → angular acceleration [rad/s²]) ────────
    # Lower kp than Crazyflie: inertia is ~100× higher, so same angular
    # acceleration requires proportionally lower gains.
    rate_kp:  [2.5, 2.5, 1.2]
    rate_ki:  [5.0, 5.0, 0.5]
    rate_kd:  [0.05, 0.05, 0.0]
    rate_kff: [0.0,  0.0,  0.0]

    # ── Gyroscope low-pass filter ──────────────────────────────────────────
    gyro_lpf_cutoff_hz: 80.0

    # ── Saturation limits ──────────────────────────────────────────────────
    att_integral_limit_deg:  [20.0, 20.0, 360.0]
    rate_integral_limit_deg: [50.0, 50.0, 200.0]
    pos_vel_max: [3.0, 3.0, 2.0]    # more headroom than Crazyflie
    roll_max_deg:  35.0
    pitch_max_deg: 35.0
    yaw_max_delta: 0.0

    # ── Thrust  (Crazyflie PWM units reused as convention: 0 – 65 535) ────
    # thrust_cmd_scale is derived automatically from drone.max_thrust.
    thrust_base:    32767.0   # Hover throttle estimate [PWM]
    thrust_min:     10000.0   # Minimum throttle [PWM]
    thrust_cmd_max: 65535.0
    vel_thrust_scale: 1000.0
